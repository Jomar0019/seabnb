<!-- HEADER -->
<%- include('partials/header')  %>

<!-- NAVBAR -->
<%- include('partials/nav')  %> 

<div class="mx-auto w-[90%] lg:w-[80%] mt-5">
    <div class="flex items-center gap-5">
        <h1 class="text-2xl font-semibold"><%= post.title  %> </h1>
        <% if(user) { %> 
        <a href="/update/<%= post._id %>" ><i class="fa-solid fa-pen-to-square text-blue-400"></i></a>
        <form action="/delete/<%= post._id %>?_method=DELETE" method="post">
            <button><i class="fa-solid fa-trash text-red-500"></i></button>
        </form>
        <% } else { } %> 
    </div>
    
    <div class="flex justify-between items-center mb-5">
        <a href="#" class="underline"><%= post.address %></a>
        <div class="space-x-5">
            <button class="hover:bg-gray-100 rounded-lg text-sm md:text-md py-2 px-2"><i class="fa-solid fa-upload"></i> &nbsp;Upload</button>
            <button class="hover:bg-gray-100 rounded-lg text-sm md:text-md py-2 px-2"><i class="fa-regular fa-heart"></i> &nbsp;Save</button>
        </div>
    </div>
    <div class="grid grid-cols-4 gap-3 rounded-xl overflow-hidden">
        <div class="col-span-4 md:col-span-2 md:row-span-2 ">
            <img class="w-full h-full object-cover" src="<%= post.img1 %>" alt="">
        </div>
        <div class="col-span-2 md:col-span-1">
            <img class="w-full h-full object-cover" src="<%= post.img2 %>" alt="">
        </div>
        <div class="col-span-2 md:col-span-1">
            <img class="w-full h-full object-cover" src="<%= post.img3 %>" alt="">
        </div>
        <div class="col-span-2 md:col-span-1">
            <img class="w-full h-full object-cover" src="<%= post.img4 %>" alt="">
        </div>
        <div class="col-span-2 md:col-span-1">
            <img class="w-full h-full object-cover" src="<%= post.img5 %>" alt="">
        </div>
    </div>

    <div class="w-full lg:w-[50%] py-10 border-b border-gray-300">
        <h1 class="text-xl font-semibold mb-2"><%= post.host %> ( Host ) </h1>
        <p>6 guests · 1 bedroom · 1 bed · 1 bath</p>
    </div>

    <div class="w-full lg:w-[50%] py-10 border-b border-gray-300">
        <h1 class="text-xl font-semibold mb-2">Description</h1>
        <p><%= post.description %></p>
    </div>

    <div class="w-full lg:w-[50%] py-10 border-b border-gray-300">
        <h1 class="text-xl font-semibold mb-5">Where you'll sleep</h1>
        <div class="border border-gray-300 w-52 h-40 p-6 rounded-lg">
            <i class="fa-solid fa-bed text-xl mb-5"></i>
            <p class="mb-1">Bedroom</p>
            <p>1 double bed</p>
        </div>
    </div>

    <div class="w-full lg:w-[50%] py-10 border-b border-gray-300">
        <h1 class="text-xl font-semibold mb-5">What this place offers</h1>
        <div class="grid grid-cols-2">
            <div class="col-span-1"><i class="fa-solid fa-wifi"></i> &nbsp; Wifi</div>
            <div class="col-span-1"><i class="fa-solid fa-tv"></i> &nbsp; TV</div>
            <div class="col-span-1"><i class="fa-solid fa-water-ladder"></i> &nbsp; Pool</div>
            <div class="col-span-1"><i class="fa-solid fa-snowflake"></i> &nbsp; Air conditioning</div>
            <div class="col-span-1"><i class="fa-solid fa-mug-saucer"></i> &nbsp; Breakfast</div>
            <div class="col-span-1"><i class="fa-regular fa-calendar"></i> &nbsp; Long term stays allowed</div>
        </div>
    </div>

    <div class="w-full py-10 border-b border-gray-300">
        
        <% if(user){ %> 

        <form action="/review" id="review" method="post" class="w-full lg:w-[50%] mb-5">
            <% if(rev.length > 0){ %> 
                <h1 class="text-xl font-semibold mb-5">Reviews</h1>
            <% } else { %> 
                <h1 class="text-xl font-semibold mb-5">No reviews (yet)</h1>
            <% } %> 

            <% rev.map(r => { %>
                <div class="w-[50%] mb-2 flex gap-3 items-center">
                    <span class="bg-gray-300 rounded-full p-5"></span>
                    <div class="border w-full rounded-lg py-2 px-4">
                        <p class="font-bold"><%= r.fullname  %> </p>
                        <p><%= r.review  %></p>
                    </div>
                </div>
            <% }) %> 

            <h2 class="text-lg mb-1">Write a review</h2>
            <input type="text" name="review" class="h-12 w-full p-5 border outline-none mb-2" placeholder="Write a review">
            <input type="hidden" name="fullname" value="<%= user.fullname %>">
            <input type="hidden" name="postId" value="<%= post._id %>">
            <button class="bg-zinc-600 text-white py-2 px-4 rounded-full">Submit</button>
        </form>

        <% } else { %> 

            <h1 class="text-xl font-semibold mb-5">Login to add and see review</h1>
            <div class="flex items-center justify-center gap-4 w-full lg:w-[50%] mb-5 border p-10 rounded-lg">
                <a href="/signup" class="border border-blue-500 py-2 px-5 text-blue-500 rounded-full font-semibold">Sign up</button>
                <a href="/login" class="bg-blue-500 py-2 px-5 text-white rounded-full font-semibold hover:bg-blue-500/80">Login</a>
            </div>

        <% } %>
        <div class="flex-row lg:flex justify-between items-center">
            <div class="lg:items-center flex mb-2 lg:mb-0">
                This host has 818 reviews for other places to stay. Show other reviews
            </div>
            <div class="items-center flex">
                We’re here to help your trip go smoothly. Every reservation is covered by Airbnb’s Guest Refund Policy.
            </div>
        </div>
    </div>
    
    <div class="w-full py-10 border-b border-gray-300">
        <h1 class="text-xl font-semibold mb-5">Where you’ll be</h1>
        <p><%= post.address %> </p>
        <div id="map" class="w-full h-[500px] p-12 my-3"></div>
        <input type="hidden" id="lat" value="<%= post.lat %>">
        <input type="hidden" id="lng" value="<%= post.lng %>">
    </div>

    <div class="w-full py-10">
        <h1 class="text-xl font-semibold mb-5">Things to know</h1>
        <div class="flex-row lg:flex justify-between">
            <div class="basis-1/3 mb-3 lg:mb-0">
                <h3 class="font-semibold mb-3">House rules</h3>
                <p><i class="fa-solid fa-clock"></i> &nbsp; Check-in: After 3:00 PM</p>
            </div>
            <div class="basis-1/3 mb-3 lg:mb-0">
                <h3 class="font-semibold mb-3">Health & safety</h3>
                <p>Airbnb's COVID-19 safety practices apply</p>
                <p>Carbon monoxide alarm</p>
                <p class="mb-5">Smoke alarm</p>
                <a href="" class="underline font-semibold">Show more > </a>
            </div>
            <div class="basis-1/3 mb-3 lg:mb-0">
                <h3 class="font-semibold mb-3">Cancellation policy</h3>
                <p class="mb-2">This reservation is non-refundable.</p>
                <p class="mb-5">Review the Host’s full cancellation policy which applies even if you cancel for illness or disruptions caused by COVID-19.</p>
                <a href="" class="underline font-semibold">Show more > </a>
            </div>
        </div>
    </div>
</div>

<div class="w-full bg-gray-100 border-t border-gray-400">
    <div class="w-[90%] lg:w-[80%] mx-auto py-2 flex-row lg:flex justify-between ">
        <div class="flex gap-5 mb-2 lg:mb-0 justify-center">
            <p class="text-sm lg:text-md">© 2022 seabnb</p>
            <a href="#" class="hover:underline text-sm lg:text-md font-thin">Privacy</a>
            <a href="#" class="hover:underline text-sm lg:text-md font-thin">Terms</a>
            <a href="#" class="hover:underline text-sm lg:text-md font-thin">Sitemap</a>
            <a href="#" class="hover:underline text-sm lg:text-md font-thin">Destinations</a>
        </div>
        <div class="flex gap-5 mb-2 lg:mb-0 justify-center">
            <a href="#" class="hover:underline text-sm lg:text-md font-semibold"><i class="fa-solid fa-globe"></i>&nbsp; English (US)</a>
            <a href="#" class="hover:underline text-sm lg:text-md font-semibold">₱ &nbsp; PHP</a>
            <a href="#" class="hover:underline text-sm lg:text-md font-semibold">Support & resources</a>
        </div>
    </div>
</div>


<script
src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDSdZBluPEbwxEySNjS0buLiXtBJH0hrGA&callback=initMap&v=weekly"
defer
></script>

<script>
  
    function initMap() {

        const latitude = document.querySelector("#lat").value;
        const longitude = document.querySelector("#lng").value;
        
        // Location
        const uluru = { lat: latitude, lng: longitude };
        // center
        const map = new google.maps.Map(document.getElementById("map"),{
            zoom: 7,
            center: uluru,
        });
        const marker = new google.maps.Marker({
            position: uluru,
            map: map,
        });
    }
    window.initMap = initMap();

    

    const form = document.querySelector('#review');

    form.addEventListener('submit', async (e) => {
        e.preventDefault();

        const fullname = form.fullname.value;
        const review = form.review.value;
        const postId = form.postId.value;

        try {
            const result = await fetch('/review', {
                method: "POST",
                body: JSON.stringify({ postId, fullname, review}),
                headers: { 'Content-Type': 'application/json'}
            });
            const data = await result.json();
        } catch (error) {
            console.log(error)
        }


    })

</script>


<!-- END -->
<%- include('partials/end')  %> 
